{
  "id": "wan22-animate-faceswap",
  "revision": 0,
  "last_node_id": 185,
  "last_link_id": 321,
  "nodes": [
    {
      "id": 66,
      "type": "ImageConcatMulti",
      "pos": [2660, -950],
      "size": [270, 150],
      "flags": {},
      "order": 59,
      "mode": 0,
      "inputs": [
        {"name": "image_1", "type": "IMAGE", "link": 87},
        {"name": "image_2", "shape": 7, "type": "IMAGE", "link": 107}
      ],
      "outputs": [
        {"name": "images", "type": "IMAGE", "links": [89]}
      ],
      "properties": {"cnr_id": "comfyui-kjnodes"},
      "widgets_values": [2, "left", true, null]
    },
    {
      "id": 137,
      "type": "GetNode",
      "pos": [2441, -1173],
      "size": [210, 60],
      "flags": {"collapsed": true},
      "order": 0,
      "mode": 0,
      "outputs": [{"name": "IMAGE", "type": "IMAGE", "links": [239]}],
      "title": "Get_face_images",
      "widgets_values": ["face_images"],
      "color": "#2a363b",
      "bgcolor": "#3f5159"
    },
    {
      "id": 140,
      "type": "GetNode",
      "pos": [2441, -1124],
      "size": [210, 60],
      "flags": {"collapsed": true},
      "order": 1,
      "mode": 0,
      "outputs": [{"name": "IMAGE", "type": "IMAGE", "links": [243]}],
      "title": "Get_pose_images",
      "widgets_values": ["pose_images"],
      "color": "#2a363b",
      "bgcolor": "#3f5159"
    },
    {
      "id": 134,
      "type": "GetNode",
      "pos": [2443, -1227],
      "size": [210, 34],
      "flags": {"collapsed": true},
      "order": 2,
      "mode": 0,
      "outputs": [{"name": "IMAGE", "type": "IMAGE", "links": [236]}],
      "title": "Get_reference_image",
      "widgets_values": ["reference_image"],
      "color": "#2a363b",
      "bgcolor": "#3f5159"
    },
    {
      "id": 148,
      "type": "SetNode",
      "pos": [-548, -2964],
      "size": [210, 60],
      "flags": {"collapsed": true},
      "order": 45,
      "mode": 0,
      "inputs": [{"name": "AUDIO", "type": "AUDIO", "link": 255}],
      "outputs": [{"name": "*", "type": "*", "links": null}],
      "title": "Set_input_audio",
      "widgets_values": ["input_audio"]
    },
    {
      "id": 149,
      "type": "GetNode",
      "pos": [3043, -1156],
      "size": [210, 60],
      "flags": {"collapsed": true},
      "order": 3,
      "mode": 0,
      "outputs": [{"name": "AUDIO", "type": "AUDIO", "links": [256]}],
      "title": "Get_input_audio",
      "widgets_values": ["input_audio"]
    },
    {
      "id": 153,
      "type": "SetNode",
      "pos": [-1605, -2832],
      "size": [210, 60],
      "flags": {"collapsed": true},
      "order": 39,
      "mode": 0,
      "inputs": [{"name": "INT", "type": "INT", "link": 263}],
      "outputs": [{"name": "*", "type": "*", "links": null}],
      "title": "Set_width",
      "widgets_values": ["width"],
      "color": "#1b4669",
      "bgcolor": "#29699c"
    },
    {
      "id": 155,
      "type": "GetNode",
      "pos": [1319, -167],
      "size": [210, 60],
      "flags": {"collapsed": true},
      "order": 4,
      "mode": 0,
      "outputs": [{"name": "INT", "type": "INT", "links": [265]}],
      "title": "Get_width",
      "widgets_values": ["width"],
      "color": "#1b4669",
      "bgcolor": "#29699c"
    },
    {
      "id": 156,
      "type": "GetNode",
      "pos": [1319, -117],
      "size": [210, 50],
      "flags": {"collapsed": true},
      "order": 5,
      "mode": 0,
      "outputs": [{"name": "INT", "type": "INT", "links": [266]}],
      "title": "Get_height",
      "widgets_values": ["height"],
      "color": "#1b4669",
      "bgcolor": "#29699c"
    },
    {
      "id": 154,
      "type": "SetNode",
      "pos": [-1617, -2533],
      "size": [210, 60],
      "flags": {"collapsed": true},
      "order": 37,
      "mode": 0,
      "inputs": [{"name": "INT", "type": "INT", "link": 264}],
      "outputs": [{"name": "*", "type": "*", "links": null}],
      "title": "Set_height",
      "widgets_values": ["height"],
      "color": "#1b4669",
      "bgcolor": "#29699c"
    },
    {
      "id": 63,
      "type": "VHS_LoadVideo",
      "pos": [-876, -3084],
      "size": [315, 491],
      "flags": {},
      "order": 38,
      "mode": 0,
      "inputs": [
        {"name": "meta_batch", "shape": 7, "type": "VHS_BatchManager", "link": null},
        {"name": "vae", "shape": 7, "type": "VAE", "link": null},
        {"name": "custom_width", "type": "INT", "widget": {"name": "custom_width"}, "link": 257},
        {"name": "custom_height", "type": "INT", "widget": {"name": "custom_height"}, "link": 258}
      ],
      "outputs": [
        {"name": "IMAGE", "type": "IMAGE", "links": [248]},
        {"name": "frame_count", "type": "INT", "links": [267]},
        {"name": "audio", "type": "AUDIO", "links": [255]},
        {"name": "video_info", "type": "VHS_VIDEOINFO", "links": null}
      ],
      "properties": {"cnr_id": "comfyui-videohelpersuite"},
      "widgets_values": {
        "video": "driving_video.mp4",
        "force_rate": 16,
        "custom_width": 832,
        "custom_height": 480,
        "frame_load_cap": 0,
        "skip_first_frames": 0,
        "select_every_nth": 1,
        "format": "AnimateDiff"
      },
      "title": "Load Driving Video"
    },
    {
      "id": 158,
      "type": "GetNode",
      "pos": [1319, -70],
      "size": [210, 60],
      "flags": {"collapsed": true},
      "order": 6,
      "mode": 0,
      "outputs": [{"name": "INT", "type": "INT", "links": [268]}],
      "title": "Get_frame_count",
      "widgets_values": ["frame_count"],
      "color": "#1b4669",
      "bgcolor": "#29699c"
    },
    {
      "id": 131,
      "type": "GetNode",
      "pos": [1319, -266],
      "size": [210, 60],
      "flags": {"collapsed": true},
      "order": 7,
      "mode": 0,
      "outputs": [{"name": "IMAGE", "type": "IMAGE", "links": [234]}],
      "title": "Get_background_image",
      "widgets_values": ["background_image"],
      "color": "#2a363b",
      "bgcolor": "#3f5159"
    },
    {
      "id": 143,
      "type": "GetNode",
      "pos": [1319, -213],
      "size": [210, 60],
      "flags": {"collapsed": true},
      "order": 8,
      "mode": 0,
      "outputs": [{"name": "MASK", "type": "MASK", "links": [247]}],
      "title": "Get_mask",
      "widgets_values": ["mask"],
      "color": "#1c5715",
      "bgcolor": "#1f401b"
    },
    {
      "id": 157,
      "type": "SetNode",
      "pos": [-528, -3030],
      "size": [210, 60],
      "flags": {"collapsed": true},
      "order": 44,
      "mode": 0,
      "inputs": [{"name": "INT", "type": "INT", "link": 267}],
      "outputs": [{"name": "*", "type": "*", "links": null}],
      "title": "Set_frame_count",
      "widgets_values": ["frame_count"],
      "color": "#1b4669",
      "bgcolor": "#29699c"
    },
    {
      "id": 144,
      "type": "SetNode",
      "pos": [-522, -3107],
      "size": [210, 60],
      "flags": {"collapsed": true},
      "order": 43,
      "mode": 0,
      "inputs": [{"name": "IMAGE", "type": "IMAGE", "link": 248}],
      "outputs": [{"name": "*", "type": "*", "links": [306]}],
      "title": "Set_input_video",
      "widgets_values": ["input_video"],
      "color": "#2a363b",
      "bgcolor": "#3f5159"
    },
    {
      "id": 128,
      "type": "SetNode",
      "pos": [-459, -1650],
      "size": [210, 60],
      "flags": {"collapsed": true},
      "order": 46,
      "mode": 0,
      "inputs": [{"name": "IMAGE", "type": "IMAGE", "link": 231}],
      "outputs": [{"name": "*", "type": "*", "links": null}],
      "title": "Set_reference_image",
      "widgets_values": ["reference_image"],
      "color": "#2a363b",
      "bgcolor": "#3f5159"
    },
    {
      "id": 64,
      "type": "ImageResizeKJv2",
      "pos": [-772, -1675],
      "size": [270, 336],
      "flags": {},
      "order": 40,
      "mode": 0,
      "inputs": [
        {"name": "image", "type": "IMAGE", "link": 82},
        {"name": "mask", "shape": 7, "type": "MASK", "link": null},
        {"name": "width", "type": "INT", "widget": {"name": "width"}, "link": 286},
        {"name": "height", "type": "INT", "widget": {"name": "height"}, "link": 287}
      ],
      "outputs": [
        {"name": "IMAGE", "type": "IMAGE", "links": [231]},
        {"name": "width", "type": "INT", "links": []},
        {"name": "height", "type": "INT", "links": []},
        {"name": "mask", "type": "MASK", "links": null}
      ],
      "properties": {"cnr_id": "comfyui-kjnodes"},
      "widgets_values": [832, 480, "lanczos", "pad_edge_pixel", "0, 0, 0", "top", 16, "cpu", ""]
    },
    {
      "id": 57,
      "type": "LoadImage",
      "pos": [-1116, -1679],
      "size": [274, 314],
      "flags": {},
      "order": 9,
      "mode": 0,
      "outputs": [
        {"name": "IMAGE", "type": "IMAGE", "links": [82]},
        {"name": "MASK", "type": "MASK", "links": null}
      ],
      "properties": {"cnr_id": "comfy-core"},
      "widgets_values": ["character_reference.png", "image"],
      "title": "Load Reference Character"
    },
    {
      "id": 142,
      "type": "SetNode",
      "pos": [1086, -2124],
      "size": [210, 60],
      "flags": {"collapsed": true},
      "order": 63,
      "mode": 0,
      "inputs": [{"name": "MASK", "type": "MASK", "link": 245}],
      "outputs": [{"name": "MASK", "type": "MASK", "links": [246]}],
      "title": "Set_mask",
      "widgets_values": ["mask"],
      "color": "#1c5715",
      "bgcolor": "#1f401b"
    },
    {
      "id": 99,
      "type": "DrawMaskOnImage",
      "pos": [1222, -2132],
      "size": [270, 78],
      "flags": {},
      "order": 64,
      "mode": 0,
      "inputs": [
        {"name": "image", "type": "IMAGE", "link": 250},
        {"name": "mask", "type": "MASK", "link": 246}
      ],
      "outputs": [{"name": "images", "type": "IMAGE", "links": [233]}],
      "properties": {"cnr_id": "comfyui-kjnodes"},
      "widgets_values": ["0, 0, 0"]
    },
    {
      "id": 146,
      "type": "GetNode",
      "pos": [1086, -2184],
      "size": [210, 60],
      "flags": {"collapsed": true},
      "order": 10,
      "mode": 0,
      "outputs": [{"name": "IMAGE", "type": "IMAGE", "links": [250]}],
      "title": "Get_input_video",
      "widgets_values": ["input_video"],
      "color": "#2a363b",
      "bgcolor": "#3f5159"
    },
    {
      "id": 130,
      "type": "SetNode",
      "pos": [1294, -2211],
      "size": [211, 60],
      "flags": {"collapsed": true},
      "order": 65,
      "mode": 0,
      "inputs": [{"name": "IMAGE", "type": "IMAGE", "link": 233}],
      "outputs": [{"name": "IMAGE", "type": "IMAGE", "links": [251]}],
      "title": "Set_background_image",
      "widgets_values": ["background_image"],
      "color": "#2a363b",
      "bgcolor": "#3f5159"
    },
    {
      "id": 163,
      "type": "GetNode",
      "pos": [1571, -468],
      "size": [210, 34],
      "flags": {"collapsed": true},
      "order": 11,
      "mode": 0,
      "outputs": [{"name": "WANVAE", "type": "WANVAE", "links": [280]}],
      "title": "Get_VAE",
      "widgets_values": ["VAE"],
      "color": "#322",
      "bgcolor": "#533"
    },
    {
      "id": 71,
      "type": "CLIPVisionLoader",
      "pos": [-512, -245],
      "size": [270, 58],
      "flags": {},
      "order": 12,
      "mode": 0,
      "outputs": [{"name": "CLIP_VISION", "type": "CLIP_VISION", "links": [97]}],
      "properties": {"cnr_id": "comfy-core"},
      "widgets_values": ["clip_vision_h.safetensors"],
      "color": "#2a363b",
      "bgcolor": "#3f5159",
      "title": "Load CLIP Vision"
    },
    {
      "id": 70,
      "type": "WanVideoClipVisionEncode",
      "pos": [989, -306],
      "size": [280, 262],
      "flags": {},
      "order": 33,
      "mode": 0,
      "inputs": [
        {"name": "clip_vision", "type": "CLIP_VISION", "link": 97},
        {"name": "image_1", "type": "IMAGE", "link": 235},
        {"name": "image_2", "shape": 7, "type": "IMAGE", "link": null},
        {"name": "negative_image", "shape": 7, "type": "IMAGE", "link": null}
      ],
      "outputs": [{"name": "image_embeds", "type": "WANVIDIMAGE_CLIPEMBEDS", "links": [96]}],
      "properties": {"cnr_id": "ComfyUI-WanVideoWrapper"},
      "widgets_values": [1, 1, "center", "average", true, 0, 0.5],
      "color": "#233",
      "bgcolor": "#355"
    },
    {
      "id": 133,
      "type": "GetNode",
      "pos": [995, -382],
      "size": [210, 50],
      "flags": {"collapsed": true},
      "order": 13,
      "mode": 0,
      "outputs": [{"name": "IMAGE", "type": "IMAGE", "links": [235, 282]}],
      "title": "Get_reference_image",
      "widgets_values": ["reference_image"],
      "color": "#2a363b",
      "bgcolor": "#3f5159"
    },
    {
      "id": 141,
      "type": "GetNode",
      "pos": [1320, -392],
      "size": [210, 34],
      "flags": {"collapsed": true},
      "order": 14,
      "mode": 0,
      "outputs": [{"name": "IMAGE", "type": "IMAGE", "links": [244]}],
      "title": "Get_pose_images",
      "widgets_values": ["pose_images"],
      "color": "#2a363b",
      "bgcolor": "#3f5159"
    },
    {
      "id": 35,
      "type": "WanVideoTorchCompileSettings",
      "pos": [-1146, -909],
      "size": [390, 202],
      "flags": {},
      "order": 15,
      "mode": 0,
      "outputs": [{"name": "torch_compile_args", "type": "WANCOMPILEARGS", "links": [100]}],
      "properties": {"cnr_id": "ComfyUI-WanVideoWrapper"},
      "widgets_values": ["inductor", false, "default", false, 64, true, 128],
      "color": "#223",
      "bgcolor": "#335"
    },
    {
      "id": 38,
      "type": "WanVideoVAELoader",
      "pos": [-569, -499],
      "size": [416, 82],
      "flags": {},
      "order": 16,
      "mode": 0,
      "inputs": [{"name": "compile_args", "shape": 7, "type": "WANCOMPILEARGS", "link": null}],
      "outputs": [{"name": "vae", "type": "WANVAE", "links": [278]}],
      "properties": {"cnr_id": "ComfyUI-WanVideoWrapper"},
      "widgets_values": ["wanvideo/Wan2_1_VAE_bf16.safetensors", "bf16"],
      "color": "#322",
      "bgcolor": "#533",
      "title": "Load VAE"
    },
    {
      "id": 161,
      "type": "SetNode",
      "pos": [-259, -357],
      "size": [210, 60],
      "flags": {"collapsed": true},
      "order": 35,
      "mode": 0,
      "inputs": [{"name": "WANVAE", "type": "WANVAE", "link": 278}],
      "outputs": [{"name": "*", "type": "*", "links": null}],
      "title": "Set_VAE",
      "widgets_values": ["VAE"],
      "color": "#322",
      "bgcolor": "#533"
    },
    {
      "id": 77,
      "type": "ImageConcatMulti",
      "pos": [2653, -1220],
      "size": [270, 190],
      "flags": {},
      "order": 36,
      "mode": 0,
      "inputs": [
        {"name": "image_1", "type": "IMAGE", "link": 236},
        {"name": "image_2", "shape": 7, "type": "IMAGE", "link": 239},
        {"name": "image_3", "shape": 7, "type": "IMAGE", "link": 243},
        {"name": "image_4", "shape": 7, "type": "IMAGE", "link": 249}
      ],
      "outputs": [{"name": "images", "type": "IMAGE", "links": [107]}],
      "properties": {"cnr_id": "comfyui-kjnodes"},
      "widgets_values": [4, "down", true, null]
    },
    {
      "id": 145,
      "type": "GetNode",
      "pos": [2463, -1073],
      "size": [210, 60],
      "flags": {"collapsed": true},
      "order": 17,
      "mode": 0,
      "outputs": [{"name": "IMAGE", "type": "IMAGE", "links": [249]}],
      "title": "Get_input_video",
      "widgets_values": ["input_video"],
      "color": "#2a363b",
      "bgcolor": "#3f5159"
    },
    {
      "id": 28,
      "type": "WanVideoDecode",
      "pos": [2485, -441],
      "size": [280, 198],
      "flags": {},
      "order": 51,
      "mode": 0,
      "inputs": [
        {"name": "vae", "type": "WANVAE", "link": 279},
        {"name": "samples", "type": "LATENT", "link": 33}
      ],
      "outputs": [{"name": "images", "type": "IMAGE", "links": [48]}],
      "properties": {"cnr_id": "ComfyUI-WanVideoWrapper"},
      "widgets_values": [false, 272, 272, 144, 128, "default"],
      "title": "Decode Video"
    },
    {
      "id": 162,
      "type": "GetNode",
      "pos": [2483, -523],
      "size": [210, 60],
      "flags": {"collapsed": true},
      "order": 18,
      "mode": 0,
      "outputs": [{"name": "WANVAE", "type": "WANVAE", "links": [279]}],
      "title": "Get_VAE",
      "widgets_values": ["VAE"],
      "color": "#322",
      "bgcolor": "#533"
    },
    {
      "id": 42,
      "type": "GetImageSizeAndCount",
      "pos": [2555, -692],
      "size": [277, 86],
      "flags": {},
      "order": 55,
      "mode": 0,
      "inputs": [{"name": "image", "type": "IMAGE", "link": 48}],
      "outputs": [
        {"name": "image", "type": "IMAGE", "links": [87]},
        {"name": "width", "type": "INT", "links": null},
        {"name": "height", "type": "INT", "links": null},
        {"name": "count", "type": "INT", "links": null}
      ],
      "properties": {"cnr_id": "comfyui-kjnodes"},
      "widgets_values": []
    },
    {
      "id": 65,
      "type": "WanVideoTextEncodeCached",
      "pos": [1329, 68],
      "size": [488, 362],
      "flags": {},
      "order": 20,
      "mode": 0,
      "inputs": [{"name": "extender_args", "shape": 7, "type": "WANVIDEOPROMPTEXTENDER_ARGS", "link": null}],
      "outputs": [
        {"name": "text_embeds", "type": "WANVIDEOTEXTEMBEDS", "links": [281]},
        {"name": "negative_text_embeds", "type": "WANVIDEOTEXTEMBEDS", "links": null},
        {"name": "positive_prompt", "type": "STRING", "links": null}
      ],
      "properties": {"cnr_id": "ComfyUI-WanVideoWrapper"},
      "widgets_values": [
        "umt5-xxl-enc-bf16.safetensors",
        "bf16",
        "person walking naturally, smooth motion, cinematic lighting",
        "blurry, distorted, static, frozen, low quality, ugly, deformed",
        "disabled",
        false,
        "gpu"
      ],
      "color": "#432",
      "bgcolor": "#653",
      "title": "Text Prompt (Motion Description)"
    },
    {
      "id": 62,
      "type": "WanVideoAnimateEmbeds",
      "pos": [1567, -396],
      "size": [274, 370],
      "flags": {},
      "order": 41,
      "mode": 0,
      "inputs": [
        {"name": "vae", "type": "WANVAE", "link": 280},
        {"name": "clip_embeds", "shape": 7, "type": "WANVIDIMAGE_CLIPEMBEDS", "link": 96},
        {"name": "ref_images", "shape": 7, "type": "IMAGE", "link": 282},
        {"name": "pose_images", "shape": 7, "type": "IMAGE", "link": 244},
        {"name": "face_images", "shape": 7, "type": "IMAGE", "link": 240},
        {"name": "bg_images", "shape": 7, "type": "IMAGE", "link": 234},
        {"name": "mask", "shape": 7, "type": "MASK", "link": 247},
        {"name": "width", "type": "INT", "widget": {"name": "width"}, "link": 265},
        {"name": "height", "type": "INT", "widget": {"name": "height"}, "link": 266},
        {"name": "num_frames", "type": "INT", "widget": {"name": "num_frames"}, "link": 268}
      ],
      "outputs": [{"name": "image_embeds", "type": "WANVIDIMAGE_EMBEDS", "links": [84]}],
      "properties": {"cnr_id": "ComfyUI-WanVideoWrapper"},
      "widgets_values": [832, 480, 501, false, 77, "disabled", 1, 1, false],
      "color": "#322",
      "bgcolor": "#533",
      "title": "Animate Embeddings"
    },
    {
      "id": 22,
      "type": "WanVideoModelLoader",
      "pos": [-700, -908],
      "size": [601, 318],
      "flags": {},
      "order": 34,
      "mode": 0,
      "inputs": [
        {"name": "compile_args", "shape": 7, "type": "WANCOMPILEARGS", "link": 100},
        {"name": "block_swap_args", "shape": 7, "type": "BLOCKSWAPARGS", "link": null},
        {"name": "lora", "shape": 7, "type": "WANVIDLORA", "link": null},
        {"name": "vram_management_args", "shape": 7, "type": "VRAM_MANAGEMENTARGS", "link": null},
        {"name": "extra_model", "shape": 7, "type": "VACEPATH", "link": null},
        {"name": "fantasytalking_model", "shape": 7, "type": "FANTASYTALKINGMODEL", "link": null},
        {"name": "multitalk_model", "shape": 7, "type": "MULTITALKMODEL", "link": null},
        {"name": "fantasyportrait_model", "shape": 7, "type": "FANTASYPORTRAITMODEL", "link": null}
      ],
      "outputs": [{"name": "model", "type": "WANVIDEOMODEL", "links": [59]}],
      "properties": {"cnr_id": "ComfyUI-WanVideoWrapper"},
      "widgets_values": [
        "WanVideo/2_2/Wan2_2-Animate-14B_fp8_e4m3fn_scaled_KJ.safetensors",
        "fp16_fast",
        "disabled",
        "offload_device",
        "sageattn",
        "default"
      ],
      "color": "#223",
      "bgcolor": "#335",
      "title": "Load Wan 2.2 Animate Model"
    },
    {
      "id": 151,
      "type": "INTConstant",
      "pos": [-1704, -2640],
      "size": [210, 58],
      "flags": {},
      "order": 22,
      "mode": 0,
      "outputs": [{"name": "value", "type": "INT", "links": [258, 264, 287]}],
      "title": "Height",
      "properties": {"cnr_id": "comfyui-kjnodes"},
      "widgets_values": [480],
      "color": "#1b4669",
      "bgcolor": "#29699c"
    },
    {
      "id": 51,
      "type": "WanVideoBlockSwap",
      "pos": [-20, -308],
      "size": [281, 202],
      "flags": {},
      "order": 23,
      "mode": 0,
      "outputs": [{"name": "block_swap_args", "type": "BLOCKSWAPARGS", "links": [64]}],
      "properties": {"cnr_id": "ComfyUI-WanVideoWrapper"},
      "widgets_values": [25, false, false, true, 0, 1, false],
      "color": "#223",
      "bgcolor": "#335"
    },
    {
      "id": 50,
      "type": "WanVideoSetBlockSwap",
      "pos": [299, -422],
      "size": [201, 46],
      "flags": {},
      "order": 47,
      "mode": 0,
      "inputs": [
        {"name": "model", "type": "WANVIDEOMODEL", "link": 62},
        {"name": "block_swap_args", "shape": 7, "type": "BLOCKSWAPARGS", "link": 64}
      ],
      "outputs": [{"name": "model", "type": "WANVIDEOMODEL", "links": [63]}],
      "properties": {"cnr_id": "ComfyUI-WanVideoWrapper"},
      "widgets_values": [],
      "color": "#223",
      "bgcolor": "#335"
    },
    {
      "id": 48,
      "type": "WanVideoSetLoRAs",
      "pos": [-5, -420],
      "size": [174, 46],
      "flags": {},
      "order": 42,
      "mode": 0,
      "inputs": [
        {"name": "model", "type": "WANVIDEOMODEL", "link": 59},
        {"name": "lora", "shape": 7, "type": "WANVIDLORA", "link": 289}
      ],
      "outputs": [{"name": "model", "type": "WANVIDEOMODEL", "links": [62]}],
      "properties": {"cnr_id": "ComfyUI-WanVideoWrapper"},
      "widgets_values": [],
      "color": "#223",
      "bgcolor": "#335"
    },
    {
      "id": 171,
      "type": "WanVideoLoraSelectMulti",
      "pos": [3, -932],
      "size": [583, 342],
      "flags": {},
      "order": 24,
      "mode": 0,
      "inputs": [
        {"name": "prev_lora", "shape": 7, "type": "WANVIDLORA", "link": null},
        {"name": "blocks", "shape": 7, "type": "SELECTEDBLOCKS", "link": null}
      ],
      "outputs": [{"name": "lora", "type": "WANVIDLORA", "links": [289]}],
      "properties": {"cnr_id": "ComfyUI-WanVideoWrapper"},
      "widgets_values": [
        "WanVideo/WanAnimate_relight_lora_fp16.safetensors",
        1,
        "WanVideo/Lightx2v/lightx2v_I2V_14B_480p_cfg_step_distill_rank64_bf16.safetensors",
        1.2,
        "none",
        1,
        "none",
        1,
        "none",
        1,
        false,
        false
      ],
      "color": "#223",
      "bgcolor": "#335",
      "title": "Load LoRAs (Relight + LightX2V)"
    },
    {
      "id": 178,
      "type": "OnnxDetectionModelLoader",
      "pos": [-506, -2398],
      "size": [351, 106],
      "flags": {},
      "order": 25,
      "mode": 0,
      "outputs": [{"name": "model", "type": "POSEMODEL", "links": [290]}],
      "properties": {"aux_id": "kijai/ComfyUI-WanAnimatePreprocess"},
      "widgets_values": [
        "vitpose-l-wholebody.onnx",
        "onnx/yolov10m.onnx",
        "CUDAExecutionProvider"
      ],
      "title": "Load Pose Detection Models"
    },
    {
      "id": 182,
      "type": "GrowMaskWithBlur",
      "pos": [431, -2222],
      "size": [292, 246],
      "flags": {},
      "order": 58,
      "mode": 0,
      "inputs": [{"name": "mask", "type": "MASK", "link": 314}],
      "outputs": [
        {"name": "mask", "type": "MASK", "links": [315]},
        {"name": "mask_inverted", "type": "MASK", "links": null}
      ],
      "properties": {"cnr_id": "comfyui-kjnodes"},
      "widgets_values": [10, 0, true, false, 0, 1, 1, false]
    },
    {
      "id": 108,
      "type": "BlockifyMask",
      "pos": [779, -2222],
      "size": [270, 58],
      "flags": {},
      "order": 61,
      "mode": 0,
      "inputs": [{"name": "masks", "type": "MASK", "link": 315}],
      "outputs": [{"name": "mask", "type": "MASK", "links": [245]}],
      "properties": {"cnr_id": "comfyui-kjnodes"},
      "widgets_values": [32]
    },
    {
      "id": 104,
      "type": "Sam2Segmentation",
      "pos": [83, -2220],
      "size": [272, 182],
      "flags": {},
      "order": 54,
      "mode": 0,
      "inputs": [
        {"name": "sam2_model", "type": "SAM2MODEL", "link": 185},
        {"name": "image", "type": "IMAGE", "link": 316},
        {"name": "coordinates_positive", "shape": 7, "type": "STRING", "link": null},
        {"name": "coordinates_negative", "shape": 7, "type": "STRING", "link": null},
        {"name": "bboxes", "shape": 7, "type": "BBOX", "link": 321},
        {"name": "mask", "shape": 7, "type": "MASK", "link": null}
      ],
      "outputs": [{"name": "mask", "type": "MASK", "links": [314]}],
      "properties": {"cnr_id": "ComfyUI-segment-anything-2"},
      "widgets_values": [false, false],
      "title": "SAM2 Segmentation"
    },
    {
      "id": 180,
      "type": "GetImageSizeAndCount",
      "pos": [-246, -3011],
      "size": [190, 86],
      "flags": {},
      "order": 48,
      "mode": 0,
      "inputs": [{"name": "image", "type": "IMAGE", "link": 306}],
      "outputs": [
        {"name": "image", "type": "IMAGE", "links": [309, 316]},
        {"name": "width", "type": "INT", "links": [307, 310]},
        {"name": "height", "type": "INT", "links": [308, 311]},
        {"name": "count", "type": "INT", "links": null}
      ],
      "properties": {"cnr_id": "comfyui-kjnodes"},
      "widgets_values": []
    },
    {
      "id": 173,
      "type": "DrawViTPose",
      "pos": [120, -2811],
      "size": [270, 178],
      "flags": {},
      "order": 52,
      "mode": 0,
      "inputs": [
        {"name": "pose_data", "type": "POSEDATA", "link": 294},
        {"name": "width", "type": "INT", "widget": {"name": "width"}, "link": 307},
        {"name": "height", "type": "INT", "widget": {"name": "height"}, "link": 308}
      ],
      "outputs": [{"name": "pose_images", "type": "IMAGE", "links": [319]}],
      "properties": {"aux_id": "kijai/ComfyUI-WanAnimatePreprocess"},
      "widgets_values": [832, 480, 16, -1, -1, "True"],
      "title": "Draw Pose"
    },
    {
      "id": 183,
      "type": "SetNode",
      "pos": [464, -3038],
      "size": [210, 60],
      "flags": {"collapsed": true},
      "order": 53,
      "mode": 0,
      "inputs": [{"name": "IMAGE", "type": "IMAGE", "link": 317}],
      "outputs": [{"name": "IMAGE", "type": "IMAGE", "links": [318]}],
      "title": "Set_face_images",
      "widgets_values": ["face_images"],
      "color": "#2a363b",
      "bgcolor": "#3f5159"
    },
    {
      "id": 184,
      "type": "SetNode",
      "pos": [442, -2784],
      "size": [210, 60],
      "flags": {"collapsed": true},
      "order": 56,
      "mode": 0,
      "inputs": [{"name": "IMAGE", "type": "IMAGE", "link": 319}],
      "outputs": [{"name": "IMAGE", "type": "IMAGE", "links": [320]}],
      "title": "Set_pose_images",
      "widgets_values": ["pose_images"],
      "color": "#2a363b",
      "bgcolor": "#3f5159"
    },
    {
      "id": 138,
      "type": "GetNode",
      "pos": [1319, -314],
      "size": [210, 50],
      "flags": {"collapsed": true},
      "order": 27,
      "mode": 0,
      "outputs": [{"name": "IMAGE", "type": "IMAGE", "links": [240]}],
      "title": "Get_face_images",
      "widgets_values": ["face_images"],
      "color": "#2a363b",
      "bgcolor": "#3f5159"
    },
    {
      "id": 172,
      "type": "PoseAndFaceDetection",
      "pos": [104, -3028],
      "size": [313, 142],
      "flags": {},
      "order": 50,
      "mode": 0,
      "inputs": [
        {"name": "model", "type": "POSEMODEL", "link": 290},
        {"name": "images", "type": "IMAGE", "link": 309},
        {"name": "retarget_image", "shape": 7, "type": "IMAGE", "link": null},
        {"name": "width", "type": "INT", "widget": {"name": "width"}, "link": 310},
        {"name": "height", "type": "INT", "widget": {"name": "height"}, "link": 311}
      ],
      "outputs": [
        {"name": "pose_data", "type": "POSEDATA", "links": [294]},
        {"name": "face_images", "type": "IMAGE", "links": [317]},
        {"name": "key_frame_body_points", "type": "STRING", "links": null},
        {"name": "bboxes", "type": "BBOX", "links": [321]}
      ],
      "properties": {"aux_id": "kijai/ComfyUI-WanAnimatePreprocess"},
      "widgets_values": [832, 480],
      "title": "Pose and Face Detection"
    },
    {
      "id": 102,
      "type": "DownloadAndLoadSAM2Model",
      "pos": [-470, -2221],
      "size": [334, 130],
      "flags": {},
      "order": 28,
      "mode": 0,
      "outputs": [{"name": "sam2_model", "type": "SAM2MODEL", "links": [185]}],
      "properties": {"cnr_id": "ComfyUI-segment-anything-2"},
      "widgets_values": ["sam2.1_hiera_base_plus.safetensors", "video", "cuda", "fp16"],
      "title": "Load SAM2 Model"
    },
    {
      "id": 150,
      "type": "INTConstant",
      "pos": [-1695, -2773],
      "size": [210, 58],
      "flags": {},
      "order": 30,
      "mode": 0,
      "outputs": [{"name": "value", "type": "INT", "links": [257, 263, 286]}],
      "title": "Width",
      "properties": {"cnr_id": "comfyui-kjnodes"},
      "widgets_values": [832],
      "color": "#1b4669",
      "bgcolor": "#29699c"
    },
    {
      "id": 27,
      "type": "WanVideoSampler",
      "pos": [2107, -539],
      "size": [315, 874],
      "flags": {},
      "order": 49,
      "mode": 0,
      "inputs": [
        {"name": "model", "type": "WANVIDEOMODEL", "link": 63},
        {"name": "image_embeds", "type": "WANVIDIMAGE_EMBEDS", "link": 84},
        {"name": "text_embeds", "shape": 7, "type": "WANVIDEOTEXTEMBEDS", "link": 281},
        {"name": "samples", "shape": 7, "type": "LATENT", "link": null},
        {"name": "feta_args", "shape": 7, "type": "FETAARGS", "link": null},
        {"name": "context_options", "shape": 7, "type": "WANVIDCONTEXT", "link": null},
        {"name": "cache_args", "shape": 7, "type": "CACHEARGS", "link": null},
        {"name": "flowedit_args", "shape": 7, "type": "FLOWEDITARGS", "link": null},
        {"name": "slg_args", "shape": 7, "type": "SLGARGS", "link": null},
        {"name": "loop_args", "shape": 7, "type": "LOOPARGS", "link": null},
        {"name": "experimental_args", "shape": 7, "type": "EXPERIMENTALARGS", "link": null},
        {"name": "sigmas", "shape": 7, "type": "SIGMAS", "link": null},
        {"name": "unianimate_poses", "shape": 7, "type": "UNIANIMATE_POSE", "link": null},
        {"name": "fantasytalking_embeds", "shape": 7, "type": "FANTASYTALKING_EMBEDS", "link": null},
        {"name": "uni3c_embeds", "shape": 7, "type": "UNI3C_EMBEDS", "link": null},
        {"name": "multitalk_embeds", "shape": 7, "type": "MULTITALK_EMBEDS", "link": null},
        {"name": "freeinit_args", "shape": 7, "type": "FREEINITARGS", "link": null}
      ],
      "outputs": [
        {"name": "samples", "type": "LATENT", "links": [33]},
        {"name": "denoised_samples", "type": "LATENT", "links": null}
      ],
      "properties": {"cnr_id": "ComfyUI-WanVideoWrapper"},
      "widgets_values": [4, 1, 5, 42, "fixed", true, "dpm++_sde", 0, 1, "", "comfy", 0, -1, false],
      "title": "Generate Video"
    },
    {
      "id": 30,
      "type": "VHS_VideoCombine",
      "pos": [3064, -1021],
      "size": [600, 400],
      "flags": {},
      "order": 62,
      "mode": 0,
      "inputs": [
        {"name": "images", "type": "IMAGE", "link": 89},
        {"name": "audio", "shape": 7, "type": "AUDIO", "link": 256},
        {"name": "meta_batch", "shape": 7, "type": "VHS_BatchManager", "link": null},
        {"name": "vae", "shape": 7, "type": "VAE", "link": null}
      ],
      "outputs": [{"name": "Filenames", "type": "VHS_FILENAMES", "links": null}],
      "properties": {"cnr_id": "comfyui-videohelpersuite"},
      "widgets_values": {
        "frame_rate": 16,
        "loop_count": 0,
        "filename_prefix": "wan_animate_output",
        "format": "video/h264-mp4",
        "pix_fmt": "yuv420p",
        "crf": 19,
        "save_metadata": true,
        "trim_to_audio": true,
        "pingpong": false,
        "save_output": true
      },
      "title": "Save Output Video"
    }
  ],
  "links": [
    [33, 27, 0, 28, 1, "LATENT"],
    [48, 28, 0, 42, 0, "IMAGE"],
    [59, 22, 0, 48, 0, "WANVIDEOMODEL"],
    [62, 48, 0, 50, 0, "WANVIDEOMODEL"],
    [63, 50, 0, 27, 0, "WANVIDEOMODEL"],
    [64, 51, 0, 50, 1, "BLOCKSWAPARGS"],
    [82, 57, 0, 64, 0, "IMAGE"],
    [84, 62, 0, 27, 1, "WANVIDIMAGE_EMBEDS"],
    [87, 42, 0, 66, 0, "IMAGE"],
    [89, 66, 0, 30, 0, "IMAGE"],
    [96, 70, 0, 62, 1, "WANVIDIMAGE_CLIPEMBEDS"],
    [97, 71, 0, 70, 0, "CLIP_VISION"],
    [100, 35, 0, 22, 0, "WANCOMPILEARGS"],
    [107, 77, 0, 66, 1, "IMAGE"],
    [185, 102, 0, 104, 0, "SAM2MODEL"],
    [231, 64, 0, 128, 0, "*"],
    [233, 99, 0, 130, 0, "*"],
    [234, 131, 0, 62, 5, "IMAGE"],
    [235, 133, 0, 70, 1, "IMAGE"],
    [236, 134, 0, 77, 0, "IMAGE"],
    [239, 137, 0, 77, 1, "IMAGE"],
    [240, 138, 0, 62, 4, "IMAGE"],
    [243, 140, 0, 77, 2, "IMAGE"],
    [244, 141, 0, 62, 3, "IMAGE"],
    [245, 108, 0, 142, 0, "*"],
    [246, 142, 0, 99, 1, "MASK"],
    [247, 143, 0, 62, 6, "MASK"],
    [248, 63, 0, 144, 0, "*"],
    [249, 145, 0, 77, 3, "IMAGE"],
    [250, 146, 0, 99, 0, "IMAGE"],
    [251, 130, 0, 75, 0, "IMAGE"],
    [255, 63, 2, 148, 0, "*"],
    [256, 149, 0, 30, 1, "AUDIO"],
    [257, 150, 0, 63, 2, "INT"],
    [258, 151, 0, 63, 3, "INT"],
    [263, 150, 0, 153, 0, "*"],
    [264, 151, 0, 154, 0, "*"],
    [265, 155, 0, 62, 7, "INT"],
    [266, 156, 0, 62, 8, "INT"],
    [267, 63, 1, 157, 0, "*"],
    [268, 158, 0, 62, 9, "INT"],
    [278, 38, 0, 161, 0, "*"],
    [279, 162, 0, 28, 0, "WANVAE"],
    [280, 163, 0, 62, 0, "WANVAE"],
    [281, 65, 0, 27, 2, "WANVIDEOTEXTEMBEDS"],
    [282, 133, 0, 62, 2, "IMAGE"],
    [286, 150, 0, 64, 2, "INT"],
    [287, 151, 0, 64, 3, "INT"],
    [289, 171, 0, 48, 1, "WANVIDLORA"],
    [290, 178, 0, 172, 0, "POSEMODEL"],
    [294, 172, 0, 173, 0, "POSEDATA"],
    [306, 144, 0, 180, 0, "IMAGE"],
    [307, 180, 1, 173, 1, "INT"],
    [308, 180, 2, 173, 2, "INT"],
    [309, 180, 0, 172, 1, "IMAGE"],
    [310, 180, 1, 172, 3, "INT"],
    [311, 180, 2, 172, 4, "INT"],
    [314, 104, 0, 182, 0, "MASK"],
    [315, 182, 0, 108, 0, "MASK"],
    [316, 180, 0, 104, 1, "IMAGE"],
    [317, 172, 1, 183, 0, "*"],
    [318, 183, 0, 174, 0, "IMAGE"],
    [319, 173, 0, 184, 0, "*"],
    [320, 184, 0, 181, 0, "IMAGE"],
    [321, 172, 3, 104, 4, "BBOX"]
  ],
  "groups": [
    {
      "id": 1,
      "title": "Reference Character Image",
      "bounding": [-1209, -1833, 990, 724],
      "color": "#3f789e",
      "font_size": 24,
      "flags": {}
    },
    {
      "id": 3,
      "title": "Preprocessing (Pose Detection + Segmentation)",
      "bounding": [-1227, -3202, 4104, 1281],
      "color": "#3f789e",
      "font_size": 24,
      "flags": {}
    },
    {
      "id": 4,
      "title": "Model Loading",
      "bounding": [-1224, -1055, 2156, 1012],
      "color": "#88A",
      "font_size": 24,
      "flags": {}
    }
  ],
  "config": {},
  "extra": {
    "ds": {"scale": 0.5, "offset": [500, 1500]},
    "info": "Wan 2.2 Animate Character Swap Workflow - Based on Kijai's example"
  },
  "version": 0.4
}
